(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,n=window.wp.apiFetch;var r=e.n(n);const s=window.React;var a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},i=s.createContext&&s.createContext(a),l=["attr","size","title"];function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){var r,s,a,i;r=e,s=t,a=n[t],(s="symbol"==typeof(i=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(s))?i:i+"")in r?Object.defineProperty(r,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[s]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p(e){return e&&e.map((e,t)=>s.createElement(e.tag,h({key:t},e.attr),p(e.child)))}function d(e){return t=>s.createElement(u,o({attr:h({},e.attr)},t),p(e.child))}function u(e){var t=t=>{var n,{attr:r,size:a,title:i}=e,c=function(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}(e,l),p=a||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),s.createElement("svg",o({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,c,{className:n,style:h(h({color:e.color||t.color},t.style),e.style),height:p,width:p,xmlns:"http://www.w3.org/2000/svg"}),i&&s.createElement("title",null,i),e.children)};return void 0!==i?s.createElement(i.Consumer,null,e=>t(e)):t(a)}function x(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"m5 12 7-7 7 7"},child:[]},{tag:"path",attr:{d:"M12 19V5"},child:[]}]})(e)}function g(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 6 9 17l-5-5"},child:[]}]})(e)}function m(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"m15 18-6-6 6-6"},child:[]}]})(e)}function f(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"line",attr:{x1:"12",x2:"12",y1:"8",y2:"12"},child:[]},{tag:"line",attr:{x1:"12",x2:"12.01",y1:"16",y2:"16"},child:[]}]})(e)}function k(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"path",attr:{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"},child:[]},{tag:"path",attr:{d:"M12 17h.01"},child:[]}]})(e)}function b(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},child:[]},{tag:"polyline",attr:{points:"7 10 12 15 17 10"},child:[]},{tag:"line",attr:{x1:"12",x2:"12",y1:"15",y2:"3"},child:[]}]})(e)}function w(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"1"},child:[]},{tag:"circle",attr:{cx:"12",cy:"5",r:"1"},child:[]},{tag:"circle",attr:{cx:"12",cy:"19",r:"1"},child:[]}]})(e)}function y(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"},child:[]},{tag:"path",attr:{d:"M14 2v4a2 2 0 0 0 2 2h4"},child:[]},{tag:"path",attr:{d:"M10 9H8"},child:[]},{tag:"path",attr:{d:"M16 13H8"},child:[]},{tag:"path",attr:{d:"M16 17H8"},child:[]}]})(e)}function v(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"9",cy:"12",r:"1"},child:[]},{tag:"circle",attr:{cx:"9",cy:"5",r:"1"},child:[]},{tag:"circle",attr:{cx:"9",cy:"19",r:"1"},child:[]},{tag:"circle",attr:{cx:"15",cy:"12",r:"1"},child:[]},{tag:"circle",attr:{cx:"15",cy:"5",r:"1"},child:[]},{tag:"circle",attr:{cx:"15",cy:"19",r:"1"},child:[]}]})(e)}function j(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"path",attr:{d:"M12 16v-4"},child:[]},{tag:"path",attr:{d:"M12 8h.01"},child:[]}]})(e)}function N(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"15 3 21 3 21 9"},child:[]},{tag:"polyline",attr:{points:"9 21 3 21 3 15"},child:[]},{tag:"line",attr:{x1:"21",x2:"14",y1:"3",y2:"10"},child:[]},{tag:"line",attr:{x1:"3",x2:"10",y1:"21",y2:"14"},child:[]}]})(e)}function S(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"},child:[]}]})(e)}function C(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"4 14 10 14 10 20"},child:[]},{tag:"polyline",attr:{points:"20 10 14 10 14 4"},child:[]},{tag:"line",attr:{x1:"14",x2:"21",y1:"10",y2:"3"},child:[]},{tag:"line",attr:{x1:"3",x2:"10",y1:"21",y2:"14"},child:[]}]})(e)}function R(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z"},child:[]},{tag:"path",attr:{d:"M12 22V12"},child:[]},{tag:"path",attr:{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7"},child:[]},{tag:"path",attr:{d:"m7.5 4.27 9 5.15"},child:[]}]})(e)}function $(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 22v-5"},child:[]},{tag:"path",attr:{d:"M9 8V2"},child:[]},{tag:"path",attr:{d:"M15 8V2"},child:[]},{tag:"path",attr:{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z"},child:[]}]})(e)}function A(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12h14"},child:[]},{tag:"path",attr:{d:"M12 5v14"},child:[]}]})(e)}function L(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"},child:[]},{tag:"path",attr:{d:"M21 3v5h-5"},child:[]},{tag:"path",attr:{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"},child:[]},{tag:"path",attr:{d:"M8 16H3v5"},child:[]}]})(e)}function T(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"},child:[]},{tag:"path",attr:{d:"m21 21-4.3-4.3"},child:[]}]})(e)}function z(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"},child:[]},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"},child:[]}]})(e)}function E(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"},child:[]}]})(e)}function B(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"},child:[]},{tag:"path",attr:{d:"M20 3v4"},child:[]},{tag:"path",attr:{d:"M22 5h-4"},child:[]},{tag:"path",attr:{d:"M4 17v2"},child:[]},{tag:"path",attr:{d:"M5 18H3"},child:[]}]})(e)}function P(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{width:"18",height:"18",x:"3",y:"3",rx:"2"},child:[]}]})(e)}function D(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 6h18"},child:[]},{tag:"path",attr:{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"},child:[]},{tag:"path",attr:{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"},child:[]},{tag:"line",attr:{x1:"10",x2:"10",y1:"11",y2:"17"},child:[]},{tag:"line",attr:{x1:"14",x2:"14",y1:"11",y2:"17"},child:[]}]})(e)}function _(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"},child:[]},{tag:"path",attr:{d:"M12 9v4"},child:[]},{tag:"path",attr:{d:"M12 17h.01"},child:[]}]})(e)}function M(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 6 6 18"},child:[]},{tag:"path",attr:{d:"m6 6 12 12"},child:[]}]})(e)}const I=window.ReactJSXRuntime;function F(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function O(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function q(e){return null==e?"—":"object"==typeof e?JSON.stringify(e):String(e)}const W=({confirmation:e,onConfirm:n,onReject:r})=>{const[s,a]=(0,t.useState)(!1),{action_id:i,tool_name:l,preview:o,status:c}=e;return"confirmed"===c?(0,I.jsxs)("div",{className:"mt-3 rounded-2xl bg-wpaia-success-bg p-4 flex items-center gap-2.5",style:{border:"1px solid #86EFAC"},children:[(0,I.jsx)("span",{className:"flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-lg bg-wpaia-success-text text-white",children:(0,I.jsx)(g,{size:14})}),(0,I.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,I.jsx)("span",{className:"text-[13px] font-semibold text-wpaia-success-text",children:"Approved"}),(0,I.jsx)("span",{className:"text-xs text-wpaia-muted",children:F(l)})]})]}):"rejected"===c?(0,I.jsxs)("div",{className:"mt-3 rounded-2xl bg-wpaia-error-bg p-4 flex items-center gap-2.5",style:{border:"1px solid #FCA5A5"},children:[(0,I.jsx)("span",{className:"flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-lg bg-wpaia-error-text text-white",children:(0,I.jsx)(M,{size:14})}),(0,I.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,I.jsx)("span",{className:"text-[13px] font-semibold text-wpaia-error-text",children:"Rejected"}),(0,I.jsx)("span",{className:"text-xs text-wpaia-muted",children:F(l)})]})]}):(0,I.jsxs)("div",{className:"mt-3 flex flex-col gap-3.5",children:[(0,I.jsxs)("div",{className:"rounded-[20px] p-[18px] flex flex-col gap-3.5",style:{background:"#FFF7ED",border:"1px solid #FDBA74"},children:[(0,I.jsxs)("div",{className:"flex items-center gap-3",children:[(0,I.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center w-9 h-9 rounded-wpaia-card",style:{background:"#FFEDD5"},children:(0,I.jsx)(_,{size:18,color:"#EA580C"})}),(0,I.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,I.jsx)("span",{className:"text-[15px] font-semibold",style:{color:"#9A3412"},children:F(l)}),o?.plugin&&(0,I.jsx)("span",{className:"text-[13px]",style:{color:"#C2410C"},children:o.plugin})]})]}),(0,I.jsx)("div",{className:"h-px w-full",style:{background:"#FDBA74",opacity:.4}}),o&&Object.keys(o).length>0&&(0,I.jsx)("div",{className:"flex flex-col gap-1.5",children:Object.entries(o).map(([e,t],n)=>(0,I.jsxs)("div",{className:"flex items-start gap-2",children:[(0,I.jsx)("span",{className:"flex-shrink-0 mt-0.5",style:{color:"#EA580C"},children:0===n?(0,I.jsx)(R,{size:14}):(0,I.jsx)(j,{size:14})}),(0,I.jsxs)("span",{className:"text-[13px]",style:{color:"#9A3412"},children:[O(e),": ",q(t)]})]},e))})]}),(0,I.jsxs)("div",{className:"flex gap-2.5",children:[(0,I.jsxs)("button",{className:"flex-1 flex items-center justify-center gap-2 h-12 text-[15px] font-semibold rounded-full bg-wpaia-bg border-0 cursor-pointer hover:bg-wpaia-border transition-colors",style:{color:"#52525B"},onClick:async()=>{a(!0),await r(i)},disabled:s,children:[(0,I.jsx)(M,{size:16,color:"#71717A"}),"Cancel"]}),(0,I.jsxs)("button",{className:"flex-1 flex items-center justify-center gap-2 h-12 text-[15px] font-semibold text-white rounded-full bg-wpaia-primary border-0 cursor-pointer hover:bg-wpaia-primary-hover transition-colors",onClick:async()=>{a(!0),await n(i)},disabled:s,children:[(0,I.jsx)(g,{size:16}),s?"Processing…":"Confirm"]})]})]})};var H={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function Z(e){H=e}var V={exec:()=>null};function Q(e,t=""){let n="string"==typeof e?e:e.source,r={replace:(e,t)=>{let s="string"==typeof t?t:t.source;return s=s.replace(Y.caret,"$1"),n=n.replace(e,s),r},getRegex:()=>new RegExp(n,t)};return r}var U=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),Y={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}>`)},X=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,G=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,J=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,K=Q(J).replace(/bull/g,G).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),ee=Q(J).replace(/bull/g,G).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),te=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,ne=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,re=Q(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ne).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),se=Q(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,G).getRegex(),ae="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",ie=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,le=Q("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",ie).replace("tag",ae).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),oe=Q(te).replace("hr",X).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ae).getRegex(),ce={blockquote:Q(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",oe).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:re,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:X,html:le,lheading:K,list:se,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:oe,table:V,text:/^[^\n]+/},he=Q("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",X).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ae).getRegex(),pe={...ce,lheading:ee,table:he,paragraph:Q(te).replace("hr",X).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",he).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ae).getRegex()},de={...ce,html:Q("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",ie).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:V,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Q(te).replace("hr",X).replace("heading"," *#{1,6} *[^\n]").replace("lheading",K).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ue=/^( {2,}|\\)\n(?!\s*$)/,xe=/[\p{P}\p{S}]/u,ge=/[\s\p{P}\p{S}]/u,me=/[^\s\p{P}\p{S}]/u,fe=Q(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,ge).getRegex(),ke=/(?!~)[\p{P}\p{S}]/u,be=/(?![*_])[\p{P}\p{S}]/u,we=Q(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",U?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),ye=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,ve=Q(ye,"u").replace(/punct/g,xe).getRegex(),je=Q(ye,"u").replace(/punct/g,ke).getRegex(),Ne="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Se=Q(Ne,"gu").replace(/notPunctSpace/g,me).replace(/punctSpace/g,ge).replace(/punct/g,xe).getRegex(),Ce=Q(Ne,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,ke).getRegex(),Re=Q("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,me).replace(/punctSpace/g,ge).replace(/punct/g,xe).getRegex(),$e=Q(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,be).getRegex(),Ae=Q("^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)","gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|[*_])/u).replace(/punctSpace/g,/(?![*_])[\s\p{P}\p{S}]/u).replace(/punct/g,be).getRegex(),Le=Q(/\\(punct)/,"gu").replace(/punct/g,xe).getRegex(),Te=Q(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),ze=Q(ie).replace("(?:--\x3e|$)","--\x3e").getRegex(),Ee=Q("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",ze).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Be=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Pe=Q(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Be).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),De=Q(/^!?\[(label)\]\[(ref)\]/).replace("label",Be).replace("ref",ne).getRegex(),_e=Q(/^!?\[(ref)\](?:\[\])?/).replace("ref",ne).getRegex(),Me=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Ie={_backpedal:V,anyPunctuation:Le,autolink:Te,blockSkip:we,br:ue,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:V,delLDelim:V,delRDelim:V,emStrongLDelim:ve,emStrongRDelimAst:Se,emStrongRDelimUnd:Re,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:Pe,nolink:_e,punctuation:fe,reflink:De,reflinkSearch:Q("reflink|nolink(?!\\()","g").replace("reflink",De).replace("nolink",_e).getRegex(),tag:Ee,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:V},Fe={...Ie,link:Q(/^!?\[(label)\]\((.*?)\)/).replace("label",Be).getRegex(),reflink:Q(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Be).getRegex()},Oe={...Ie,emStrongRDelimAst:Ce,emStrongLDelim:je,delLDelim:$e,delRDelim:Ae,url:Q(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Me).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Q(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Me).getRegex()},qe={...Oe,br:Q(ue).replace("{2,}","*").getRegex(),text:Q(Oe.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},We={normal:ce,gfm:pe,pedantic:de},He={normal:Ie,gfm:Oe,breaks:qe,pedantic:Fe},Ze={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ve=e=>Ze[e];function Qe(e,t){if(t){if(Y.escapeTest.test(e))return e.replace(Y.escapeReplace,Ve)}else if(Y.escapeTestNoEncode.test(e))return e.replace(Y.escapeReplaceNoEncode,Ve);return e}function Ue(e){try{e=encodeURI(e).replace(Y.percentDecode,"%")}catch{return null}return e}function Ye(e,t){let n=e.replace(Y.findPipe,(e,t,n)=>{let r=!1,s=t;for(;--s>=0&&"\\"===n[s];)r=!r;return r?"|":" |"}).split(Y.splitPipe),r=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(Y.slashPipe,"|");return n}function Xe(e,t,n){let r=e.length;if(0===r)return"";let s=0;for(;s<r;){let a=e.charAt(r-s-1);if(a!==t||n){if(a===t||!n)break;s++}else s++}return e.slice(0,r-s)}function Ge(e,t=0){let n=t,r="";for(let t of e)if("\t"===t){let e=4-n%4;r+=" ".repeat(e),n+=e}else r+=t,n++;return r}function Je(e,t,n,r,s){let a=t.href,i=t.title||null,l=e[1].replace(s.other.outputLinkReplace,"$1");r.state.inLink=!0;let o={type:"!"===e[0].charAt(0)?"image":"link",raw:n,href:a,title:i,text:l,tokens:r.inlineTokens(l)};return r.state.inLink=!1,o}var Ke=class{options;rules;lexer;constructor(e){this.options=e||H}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:Xe(e,"\n")}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let e=t[0],n=function(e,t,n){let r=e.match(n.other.indentCodeCompensation);if(null===r)return t;let s=r[1];return t.split("\n").map(e=>{let t=e.match(n.other.beginningSpace);if(null===t)return e;let[r]=t;return r.length>=s.length?e.slice(s.length):e}).join("\n")}(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){let t=Xe(e,"#");(this.options.pedantic||!t||this.rules.other.endingSpaceChar.test(t))&&(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:Xe(t[0],"\n")}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let e=Xe(t[0],"\n").split("\n"),n="",r="",s=[];for(;e.length>0;){let t,a=!1,i=[];for(t=0;t<e.length;t++)if(this.rules.other.blockquoteStart.test(e[t]))i.push(e[t]),a=!0;else{if(a)break;i.push(e[t])}e=e.slice(t);let l=i.join("\n"),o=l.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}\n${l}`:l,r=r?`${r}\n${o}`:o;let c=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(o,s,!0),this.lexer.state.top=c,0===e.length)break;let h=s.at(-1);if("code"===h?.type)break;if("blockquote"===h?.type){let t=h,a=t.raw+"\n"+e.join("\n"),i=this.blockquote(a);s[s.length-1]=i,n=n.substring(0,n.length-t.raw.length)+i.raw,r=r.substring(0,r.length-t.text.length)+i.text;break}if("list"===h?.type){let t=h,a=t.raw+"\n"+e.join("\n"),i=this.list(a);s[s.length-1]=i,n=n.substring(0,n.length-h.raw.length)+i.raw,r=r.substring(0,r.length-t.raw.length)+i.raw,e=a.substring(s.at(-1).raw.length).split("\n");continue}}return{type:"blockquote",raw:n,tokens:s,text:r}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim(),r=n.length>1,s={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");let a=this.rules.other.listItemRegex(n),i=!1;for(;e;){let n=!1,r="",l="";if(!(t=a.exec(e))||this.rules.block.hr.test(e))break;r=t[0],e=e.substring(r.length);let o=Ge(t[2].split("\n",1)[0],t[1].length),c=e.split("\n",1)[0],h=!o.trim(),p=0;if(this.options.pedantic?(p=2,l=o.trimStart()):h?p=t[1].length+1:(p=o.search(this.rules.other.nonSpaceChar),p=p>4?1:p,l=o.slice(p),p+=t[1].length),h&&this.rules.other.blankLine.test(c)&&(r+=c+"\n",e=e.substring(c.length+1),n=!0),!n){let t=this.rules.other.nextBulletRegex(p),n=this.rules.other.hrRegex(p),s=this.rules.other.fencesBeginRegex(p),a=this.rules.other.headingBeginRegex(p),i=this.rules.other.htmlBeginRegex(p),d=this.rules.other.blockquoteBeginRegex(p);for(;e;){let u,x=e.split("\n",1)[0];if(c=x,this.options.pedantic?(c=c.replace(this.rules.other.listReplaceNesting,"  "),u=c):u=c.replace(this.rules.other.tabCharGlobal,"    "),s.test(c)||a.test(c)||i.test(c)||d.test(c)||t.test(c)||n.test(c))break;if(u.search(this.rules.other.nonSpaceChar)>=p||!c.trim())l+="\n"+u.slice(p);else{if(h||o.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||s.test(o)||a.test(o)||n.test(o))break;l+="\n"+c}h=!c.trim(),r+=x+"\n",e=e.substring(x.length+1),o=u.slice(p)}}s.loose||(i?s.loose=!0:this.rules.other.doubleBlankLine.test(r)&&(i=!0)),s.items.push({type:"list_item",raw:r,task:!!this.options.gfm&&this.rules.other.listIsTask.test(l),loose:!1,text:l,tokens:[]}),s.raw+=r}let l=s.items.at(-1);if(!l)return;l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd(),s.raw=s.raw.trimEnd();for(let e of s.items){if(this.lexer.state.top=!1,e.tokens=this.lexer.blockTokens(e.text,[]),e.task){if(e.text=e.text.replace(this.rules.other.listReplaceTask,""),"text"===e.tokens[0]?.type||"paragraph"===e.tokens[0]?.type){e.tokens[0].raw=e.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),e.tokens[0].text=e.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let e=this.lexer.inlineQueue.length-1;e>=0;e--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[e].src)){this.lexer.inlineQueue[e].src=this.lexer.inlineQueue[e].src.replace(this.rules.other.listReplaceTask,"");break}}let t=this.rules.other.listTaskCheckbox.exec(e.raw);if(t){let n={type:"checkbox",raw:t[0]+" ",checked:"[ ]"!==t[0]};e.checked=n.checked,s.loose?e.tokens[0]&&["paragraph","text"].includes(e.tokens[0].type)&&"tokens"in e.tokens[0]&&e.tokens[0].tokens?(e.tokens[0].raw=n.raw+e.tokens[0].raw,e.tokens[0].text=n.raw+e.tokens[0].text,e.tokens[0].tokens.unshift(n)):e.tokens.unshift({type:"paragraph",raw:n.raw,text:n.raw,tokens:[n]}):e.tokens.unshift(n)}}if(!s.loose){let t=e.tokens.filter(e=>"space"===e.type),n=t.length>0&&t.some(e=>this.rules.other.anyLine.test(e.raw));s.loose=n}}if(s.loose)for(let e of s.items){e.loose=!0;for(let t of e.tokens)"text"===t.type&&(t.type="paragraph")}return s}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:n,title:r}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let n=Ye(t[1]),r=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let e of r)this.rules.other.tableAlignRight.test(e)?a.align.push("right"):this.rules.other.tableAlignCenter.test(e)?a.align.push("center"):this.rules.other.tableAlignLeft.test(e)?a.align.push("left"):a.align.push(null);for(let e=0;e<n.length;e++)a.header.push({text:n[e],tokens:this.lexer.inline(n[e]),header:!0,align:a.align[e]});for(let e of s)a.rows.push(Ye(e,a.header.length).map((e,t)=>({text:e,tokens:this.lexer.inline(e),header:!1,align:a.align[t]})));return a}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;let t=Xe(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{let e=function(e,t){if(-1===e.indexOf(t[1]))return-1;let n=0;for(let r=0;r<e.length;r++)if("\\"===e[r])r++;else if(e[r]===t[0])n++;else if(e[r]===t[1]&&(n--,n<0))return r;return n>0?-2:-1}(t[2],"()");if(-2===e)return;if(e>-1){let n=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,n).trim(),t[3]=""}}let n=t[2],r="";if(this.options.pedantic){let e=this.rules.other.pedanticHrefTitle.exec(n);e&&(n=e[1],r=e[3])}else r=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(n=this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?n.slice(1):n.slice(1,-1)),Je(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:r&&r.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let e=t[(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!e){let e=n[0].charAt(0);return{type:"text",raw:e,text:e}}return Je(n,e,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let r=this.rules.inline.emStrongLDelim.exec(e);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!r[1]&&!r[2]||!n||this.rules.inline.punctuation.exec(n))){let n,s,a=[...r[0]].length-1,i=a,l=0,o="*"===r[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(o.lastIndex=0,t=t.slice(-1*e.length+a);null!=(r=o.exec(t));){if(n=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!n)continue;if(s=[...n].length,r[3]||r[4]){i+=s;continue}if((r[5]||r[6])&&a%3&&!((a+s)%3)){l+=s;continue}if(i-=s,i>0)continue;s=Math.min(s,s+i+l);let t=[...r[0]][0].length,o=e.slice(0,a+r.index+t+s);if(Math.min(a,s)%2){let e=o.slice(1,-1);return{type:"em",raw:o,text:e,tokens:this.lexer.inlineTokens(e)}}let c=o.slice(2,-2);return{type:"strong",raw:o,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(e),r=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return n&&r&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e,t,n=""){let r=this.rules.inline.delLDelim.exec(e);if(r&&(!r[1]||!n||this.rules.inline.punctuation.exec(n))){let n,s,a=[...r[0]].length-1,i=a,l=this.rules.inline.delRDelim;for(l.lastIndex=0,t=t.slice(-1*e.length+a);null!=(r=l.exec(t));){if(n=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!n||(s=[...n].length,s!==a))continue;if(r[3]||r[4]){i+=s;continue}if(i-=s,i>0)continue;s=Math.min(s,s+i);let t=[...r[0]][0].length,l=e.slice(0,a+r.index+t+s),o=l.slice(a,-a);return{type:"del",raw:l,text:o,tokens:this.lexer.inlineTokens(o)}}}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let e,n;return"@"===t[2]?(e=t[1],n="mailto:"+e):(e=t[1],n=e),{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,n;if("@"===t[2])e=t[0],n="mailto:"+e;else{let r;do{r=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??""}while(r!==t[0]);e=t[0],n="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}},et=class e{tokens;options;state;inlineQueue;tokenizer;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||H,this.options.tokenizer=this.options.tokenizer||new Ke,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:Y,block:We.normal,inline:He.normal};this.options.pedantic?(t.block=We.pedantic,t.inline=He.pedantic):this.options.gfm&&(t.block=We.gfm,this.options.breaks?t.inline=He.breaks:t.inline=He.gfm),this.tokenizer.rules=t}static get rules(){return{block:We,inline:He}}static lex(t,n){return new e(n).lex(t)}static lexInline(t,n){return new e(n).inlineTokens(t)}lex(e){e=e.replace(Y.carriageReturn,"\n"),this.blockTokens(e,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){let t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){for(this.options.pedantic&&(e=e.replace(Y.tabCharGlobal,"    ").replace(Y.spaceLine,""));e;){let r;if(this.options.extensions?.block?.some(n=>!!(r=n.call({lexer:this},e,t))&&(e=e.substring(r.raw.length),t.push(r),!0)))continue;if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length);let n=t.at(-1);1===r.raw.length&&void 0!==n?n.raw+="\n":t.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length);let n=t.at(-1);"paragraph"===n?.type||"text"===n?.type?(n.raw+=(n.raw.endsWith("\n")?"":"\n")+r.raw,n.text+="\n"+r.text,this.inlineQueue.at(-1).src=n.text):t.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length);let n=t.at(-1);"paragraph"===n?.type||"text"===n?.type?(n.raw+=(n.raw.endsWith("\n")?"":"\n")+r.raw,n.text+="\n"+r.raw,this.inlineQueue.at(-1).src=n.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title},t.push(r));continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),t.push(r);continue}let s=e;if(this.options.extensions?.startBlock){let t,n=1/0,r=e.slice(1);this.options.extensions.startBlock.forEach(e=>{t=e.call({lexer:this},r),"number"==typeof t&&t>=0&&(n=Math.min(n,t))}),n<1/0&&n>=0&&(s=e.substring(0,n+1))}if(this.state.top&&(r=this.tokenizer.paragraph(s))){let a=t.at(-1);n&&"paragraph"===a?.type?(a.raw+=(a.raw.endsWith("\n")?"":"\n")+r.raw,a.text+="\n"+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(r),n=s.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length);let n=t.at(-1);"text"===n?.type?(n.raw+=(n.raw.endsWith("\n")?"":"\n")+r.raw,n.text+="\n"+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=n.text):t.push(r);continue}if(e){let t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,r=e,s=null;if(this.tokens.links){let e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(s=this.tokenizer.rules.inline.reflinkSearch.exec(r));)e.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(s=this.tokenizer.rules.inline.anyPunctuation.exec(r));)r=r.slice(0,s.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;null!=(s=this.tokenizer.rules.inline.blockSkip.exec(r));)n=s[2]?s[2].length:0,r=r.slice(0,s.index+n)+"["+"a".repeat(s[0].length-n-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=this.options.hooks?.emStrongMask?.call({lexer:this},r)??r;let a=!1,i="";for(;e;){let n;if(a||(i=""),a=!1,this.options.extensions?.inline?.some(r=>!!(n=r.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0)))continue;if(n=this.tokenizer.escape(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.tag(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.link(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length);let r=t.at(-1);"text"===n.type&&"text"===r?.type?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(n=this.tokenizer.emStrong(e,r,i)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.codespan(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.br(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.del(e,r,i)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.autolink(e)){e=e.substring(n.raw.length),t.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(e))){e=e.substring(n.raw.length),t.push(n);continue}let s=e;if(this.options.extensions?.startInline){let t,n=1/0,r=e.slice(1);this.options.extensions.startInline.forEach(e=>{t=e.call({lexer:this},r),"number"==typeof t&&t>=0&&(n=Math.min(n,t))}),n<1/0&&n>=0&&(s=e.substring(0,n+1))}if(n=this.tokenizer.inlineText(s)){e=e.substring(n.raw.length),"_"!==n.raw.slice(-1)&&(i=n.raw.slice(-1)),a=!0;let r=t.at(-1);"text"===r?.type?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(e){let t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return t}},tt=class{options;parser;constructor(e){this.options=e||H}space(e){return""}code({text:e,lang:t,escaped:n}){let r=(t||"").match(Y.notSpaceStart)?.[0],s=e.replace(Y.endingNewline,"")+"\n";return r?'<pre><code class="language-'+Qe(r)+'">'+(n?s:Qe(s,!0))+"</code></pre>\n":"<pre><code>"+(n?s:Qe(s,!0))+"</code></pre>\n"}blockquote({tokens:e}){return`<blockquote>\n${this.parser.parse(e)}</blockquote>\n`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>\n`}hr(e){return"<hr>\n"}list(e){let t=e.ordered,n=e.start,r="";for(let t=0;t<e.items.length;t++){let n=e.items[t];r+=this.listitem(n)}let s=t?"ol":"ul";return"<"+s+(t&&1!==n?' start="'+n+'"':"")+">\n"+r+"</"+s+">\n"}listitem(e){return`<li>${this.parser.parse(e.tokens)}</li>\n`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>\n`}table(e){let t="",n="";for(let t=0;t<e.header.length;t++)n+=this.tablecell(e.header[t]);t+=this.tablerow({text:n});let r="";for(let t=0;t<e.rows.length;t++){let s=e.rows[t];n="";for(let e=0;e<s.length;e++)n+=this.tablecell(s[e]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),"<table>\n<thead>\n"+t+"</thead>\n"+r+"</table>\n"}tablerow({text:e}){return`<tr>\n${e}</tr>\n`}tablecell(e){let t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>\n`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${Qe(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){let r=this.parser.parseInline(n),s=Ue(e);if(null===s)return r;let a='<a href="'+(e=s)+'"';return t&&(a+=' title="'+Qe(t)+'"'),a+=">"+r+"</a>",a}image({href:e,title:t,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let s=Ue(e);if(null===s)return Qe(n);let a=`<img src="${e=s}" alt="${Qe(n)}"`;return t&&(a+=` title="${Qe(t)}"`),a+=">",a}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:Qe(e.text)}},nt=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}checkbox({raw:e}){return e}},rt=class e{options;renderer;textRenderer;constructor(e){this.options=e||H,this.options.renderer=this.options.renderer||new tt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new nt}static parse(t,n){return new e(n).parse(t)}static parseInline(t,n){return new e(n).parseInline(t)}parse(e){let t="";for(let n=0;n<e.length;n++){let r=e[n];if(this.options.extensions?.renderers?.[r.type]){let e=r,n=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==n||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(e.type)){t+=n||"";continue}}let s=r;switch(s.type){case"space":t+=this.renderer.space(s);break;case"hr":t+=this.renderer.hr(s);break;case"heading":t+=this.renderer.heading(s);break;case"code":t+=this.renderer.code(s);break;case"table":t+=this.renderer.table(s);break;case"blockquote":t+=this.renderer.blockquote(s);break;case"list":t+=this.renderer.list(s);break;case"checkbox":t+=this.renderer.checkbox(s);break;case"html":t+=this.renderer.html(s);break;case"def":t+=this.renderer.def(s);break;case"paragraph":t+=this.renderer.paragraph(s);break;case"text":t+=this.renderer.text(s);break;default:{let e='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return t}parseInline(e,t=this.renderer){let n="";for(let r=0;r<e.length;r++){let s=e[r];if(this.options.extensions?.renderers?.[s.type]){let e=this.options.extensions.renderers[s.type].call({parser:this},s);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){n+=e||"";continue}}let a=s;switch(a.type){case"escape":case"text":n+=t.text(a);break;case"html":n+=t.html(a);break;case"link":n+=t.link(a);break;case"image":n+=t.image(a);break;case"checkbox":n+=t.checkbox(a);break;case"strong":n+=t.strong(a);break;case"em":n+=t.em(a);break;case"codespan":n+=t.codespan(a);break;case"br":n+=t.br(a);break;case"del":n+=t.del(a);break;default:{let e='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}},st=class{options;block;constructor(e){this.options=e||H}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}emStrongMask(e){return e}provideLexer(){return this.block?et.lex:et.lexInline}provideParser(){return this.block?rt.parse:rt.parseInline}},at=new class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=rt;Renderer=tt;TextRenderer=nt;Lexer=et;Tokenizer=Ke;Hooks=st;constructor(...e){this.use(...e)}walkTokens(e,t){let n=[];for(let r of e)switch(n=n.concat(t.call(this,r)),r.type){case"table":{let e=r;for(let r of e.header)n=n.concat(this.walkTokens(r.tokens,t));for(let r of e.rows)for(let e of r)n=n.concat(this.walkTokens(e.tokens,t));break}case"list":{let e=r;n=n.concat(this.walkTokens(e.items,t));break}default:{let e=r;this.defaults.extensions?.childTokens?.[e.type]?this.defaults.extensions.childTokens[e.type].forEach(r=>{let s=e[r].flat(1/0);n=n.concat(this.walkTokens(s,t))}):e.tokens&&(n=n.concat(this.walkTokens(e.tokens,t)))}}return n}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(e=>{let n={...e};if(n.async=this.defaults.async||n.async||!1,e.extensions&&(e.extensions.forEach(e=>{if(!e.name)throw new Error("extension name required");if("renderer"in e){let n=t.renderers[e.name];t.renderers[e.name]=n?function(...t){let r=e.renderer.apply(this,t);return!1===r&&(r=n.apply(this,t)),r}:e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");let n=t[e.level];n?n.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)}),n.extensions=t),e.renderer){let t=this.defaults.renderer||new tt(this.defaults);for(let n in e.renderer){if(!(n in t))throw new Error(`renderer '${n}' does not exist`);if(["options","parser"].includes(n))continue;let r=n,s=e.renderer[r],a=t[r];t[r]=(...e)=>{let n=s.apply(t,e);return!1===n&&(n=a.apply(t,e)),n||""}}n.renderer=t}if(e.tokenizer){let t=this.defaults.tokenizer||new Ke(this.defaults);for(let n in e.tokenizer){if(!(n in t))throw new Error(`tokenizer '${n}' does not exist`);if(["options","rules","lexer"].includes(n))continue;let r=n,s=e.tokenizer[r],a=t[r];t[r]=(...e)=>{let n=s.apply(t,e);return!1===n&&(n=a.apply(t,e)),n}}n.tokenizer=t}if(e.hooks){let t=this.defaults.hooks||new st;for(let n in e.hooks){if(!(n in t))throw new Error(`hook '${n}' does not exist`);if(["options","block"].includes(n))continue;let r=n,s=e.hooks[r],a=t[r];st.passThroughHooks.has(n)?t[r]=e=>{if(this.defaults.async&&st.passThroughHooksRespectAsync.has(n))return(async()=>{let n=await s.call(t,e);return a.call(t,n)})();let r=s.call(t,e);return a.call(t,r)}:t[r]=(...e)=>{if(this.defaults.async)return(async()=>{let n=await s.apply(t,e);return!1===n&&(n=await a.apply(t,e)),n})();let n=s.apply(t,e);return!1===n&&(n=a.apply(t,e)),n}}n.hooks=t}if(e.walkTokens){let t=this.defaults.walkTokens,r=e.walkTokens;n.walkTokens=function(e){let n=[];return n.push(r.call(this,e)),t&&(n=n.concat(t.call(this,e))),n}}this.defaults={...this.defaults,...n}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return et.lex(e,t??this.defaults)}parser(e,t){return rt.parse(e,t??this.defaults)}parseMarkdown(e){return(t,n)=>{let r={...n},s={...this.defaults,...r},a=this.onError(!!s.silent,!!s.async);if(!0===this.defaults.async&&!1===r.async)return a(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||null===t)return a(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof t)return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=e),s.async)return(async()=>{let n=s.hooks?await s.hooks.preprocess(t):t,r=await(s.hooks?await s.hooks.provideLexer():e?et.lex:et.lexInline)(n,s),a=s.hooks?await s.hooks.processAllTokens(r):r;s.walkTokens&&await Promise.all(this.walkTokens(a,s.walkTokens));let i=await(s.hooks?await s.hooks.provideParser():e?rt.parse:rt.parseInline)(a,s);return s.hooks?await s.hooks.postprocess(i):i})().catch(a);try{s.hooks&&(t=s.hooks.preprocess(t));let n=(s.hooks?s.hooks.provideLexer():e?et.lex:et.lexInline)(t,s);s.hooks&&(n=s.hooks.processAllTokens(n)),s.walkTokens&&this.walkTokens(n,s.walkTokens);let r=(s.hooks?s.hooks.provideParser():e?rt.parse:rt.parseInline)(n,s);return s.hooks&&(r=s.hooks.postprocess(r)),r}catch(e){return a(e)}}}onError(e,t){return n=>{if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e){let e="<p>An error occurred:</p><pre>"+Qe(n.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(n);throw n}}};function it(e,t){return at.parse(e,t)}it.options=it.setOptions=function(e){return at.setOptions(e),it.defaults=at.defaults,Z(it.defaults),it},it.getDefaults=function(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}},it.defaults=H,it.use=function(...e){return at.use(...e),it.defaults=at.defaults,Z(it.defaults),it},it.walkTokens=function(e,t){return at.walkTokens(e,t)},it.parseInline=at.parseInline,it.Parser=rt,it.parser=rt.parse,it.Renderer=tt,it.TextRenderer=nt,it.Lexer=et,it.lexer=et.lex,it.Tokenizer=Ke,it.Hooks=st,it.parse=it,it.options,it.setOptions,it.use,it.walkTokens,it.parseInline,rt.parse,et.lex,it.setOptions({breaks:!0,gfm:!0,headerIds:!1,mangle:!1});const lt=new Set(["p","br","strong","b","em","i","code","pre","ul","ol","li","h1","h2","h3","h4","h5","h6","a","blockquote","hr","table","thead","tbody","tr","th","td"]),ot=({content:e})=>{const n=(0,t.useRef)(null),r=(0,t.useMemo)(()=>e?function(e){return e.replace(/<\/?([a-zA-Z][a-zA-Z0-9]*)\b[^>]*>/g,(e,t)=>{const n=t.toLowerCase();if(lt.has(n)){if("a"===n){const t=e.match(/href="([^"]*)"/);return t?e.startsWith("</")?"</a>":`<a href="${t[1]}" target="_blank" rel="noopener noreferrer">`:e.startsWith("</")?"</a>":"<a>"}return e}return""})}(it.parse(e)):"",[e]);return(0,t.useEffect)(()=>{n.current&&n.current.querySelectorAll("pre").forEach(e=>{if(e.querySelector(".wpaia-copy-btn"))return;const t=document.createElement("div");t.className="wpaia-code-wrapper",e.parentNode.insertBefore(t,e),t.appendChild(e);const n=document.createElement("button");n.className="wpaia-copy-btn",n.textContent="Copy",n.setAttribute("aria-label","Copy code to clipboard"),n.addEventListener("click",()=>{const t=e.querySelector("code")?.textContent||e.textContent;navigator.clipboard.writeText(t).then(()=>{n.textContent="Copied!",n.classList.add("wpaia-copy-btn-success"),setTimeout(()=>{n.textContent="Copy",n.classList.remove("wpaia-copy-btn-success")},2e3)})}),t.appendChild(n)})},[r]),e?(0,I.jsx)("div",{ref:n,className:"wpaia-markdown",dangerouslySetInnerHTML:{__html:r}}):null},ct=({content:e,isStreaming:n})=>{const[r,s]=(0,t.useState)(!1);return(0,I.jsxs)("div",{className:"mb-2",children:[(0,I.jsxs)("button",{className:"flex items-center gap-1.5 px-0 py-1 border-0 bg-transparent text-xs text-wpaia-muted hover:text-wpaia-text cursor-pointer font-sans",onClick:()=>s(e=>!e),"aria-expanded":r,children:[(0,I.jsx)("span",{className:"text-[10px]",children:r?"▼":"▶"}),n?"⏳ Thinking…":"💭 View thinking process"]}),r&&(0,I.jsx)("div",{className:"mt-1 px-3 py-2 text-xs text-wpaia-muted bg-wpaia-bg rounded-lg border border-wpaia-border whitespace-pre-wrap font-mono leading-relaxed",children:e||"…"})]})},ht=e=>{if(!e)return null;const t=new Date(e),n=new Date,r=n-t,s=Math.floor(r/6e4);return s<1?"just now":s<60?`${s}m ago`:t.toDateString()===n.toDateString()?t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):r<6048e5?t.toLocaleDateString([],{weekday:"short"})+" "+t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric"})+" "+t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})},pt=[{icon:$,label:"Update plugins",iconColor:"#8B5CF6"},{icon:y,label:"Create a post",iconColor:"#14B8A6"},{icon:T,label:"Search & replace",iconColor:"#F472B6"},{icon:E,label:"Site health",iconColor:"#71717A"}],dt=()=>(0,I.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center w-8 h-8 rounded-full bg-wpaia-primary text-white","aria-hidden":"true",children:(0,I.jsx)(B,{size:16})}),ut=({toolsRunning:e})=>{const t=1===e.length?e[0].replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())+"…":`Running ${e.length} tools…`;return(0,I.jsxs)("div",{className:"mt-2 rounded-2xl bg-wpaia-bg p-4",children:[(0,I.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,I.jsx)("span",{className:"wpaia-spinner flex-shrink-0","aria-hidden":"true"}),(0,I.jsx)("div",{className:"flex flex-col gap-0.5",children:(0,I.jsx)("span",{className:"text-[13px] font-semibold text-wpaia-text",children:t})})]}),e.length>1&&(0,I.jsx)("div",{className:"mt-3 flex flex-col gap-2 pl-[38px]",children:e.map((e,t)=>(0,I.jsxs)("div",{className:"flex items-center gap-2 text-xs text-wpaia-muted",children:[(0,I.jsx)("span",{className:"wpaia-spinner-sm flex-shrink-0","aria-hidden":"true"}),(0,I.jsx)("span",{children:e.replace(/_/g," ")})]},t))})]})},xt=({status:e,toolName:t,detail:n})=>(0,I.jsx)("div",{className:"mt-2 rounded-2xl bg-wpaia-bg p-4",children:(0,I.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,I.jsx)("span",{className:"flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-lg text-white "+("success"===e?"bg-[#14B8A6]":"error"===e?"bg-wpaia-error-text":"bg-wpaia-muted"),children:"success"===e?(0,I.jsx)(g,{size:14}):"running"===e?(0,I.jsx)("span",{className:"wpaia-spinner-sm"}):(0,I.jsx)(M,{size:14})}),(0,I.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,I.jsx)("span",{className:"text-[13px] font-semibold text-wpaia-text",children:t}),n&&(0,I.jsx)("span",{className:"text-xs text-wpaia-muted",children:n})]})]})}),gt=({errorTitle:e,errorDetail:t,errorMessage:n})=>(0,I.jsxs)("div",{className:"rounded-2xl bg-wpaia-error-bg border border-solid border-[#FECACA] p-4 flex flex-col gap-2.5",children:[(0,I.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,I.jsx)("span",{className:"flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-lg bg-[#FECACA]",children:(0,I.jsx)(M,{size:14,className:"text-wpaia-error-text"})}),(0,I.jsxs)("div",{className:"flex flex-col gap-px",children:[(0,I.jsx)("span",{className:"text-[13px] font-semibold text-[#991B1B]",children:e}),t&&(0,I.jsx)("span",{className:"text-xs text-wpaia-error-text",children:t})]})]}),(0,I.jsx)("div",{className:"h-px bg-[#FECACA] opacity-60"}),(0,I.jsxs)("div",{className:"flex items-center gap-2 rounded-wpaia-card bg-white p-2.5 px-3.5",children:[(0,I.jsx)(f,{size:14,className:"flex-shrink-0 text-wpaia-error-text"}),(0,I.jsx)("span",{className:"text-[13px] text-[#991B1B] leading-snug",children:n})]})]}),mt=({messages:e,loading:n,onConfirm:r,onReject:s,onRetry:a,onDismissError:i,onChipSelect:l})=>{const o=(0,t.useRef)(null);(0,t.useEffect)(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[e,n]);const c=e=>"assistant"===e.role&&e.content?(0,I.jsx)(ot,{content:e.content}):e.content;return(0,I.jsxs)("div",{className:"flex-1 overflow-y-auto px-5 py-5 wpaia-scrollbar",role:"log","aria-live":"polite",children:[0===e.length&&!n&&(0,I.jsxs)("div",{className:"flex flex-col items-center justify-center text-center px-6 h-full min-h-[300px] gap-8",style:{paddingBottom:16},children:[(0,I.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,I.jsx)("div",{className:"wpaia-empty-icon-gradient flex items-center justify-center w-[72px] h-[72px] rounded-full","aria-hidden":"true",children:(0,I.jsx)(B,{size:32,color:"#FFFFFF"})}),(0,I.jsx)("h2",{className:"text-[28px] font-bold text-[#18181B] font-heading m-0 leading-tight",children:"How can I help?"}),(0,I.jsx)("p",{className:"text-sm text-wpaia-muted max-w-[300px] leading-normal m-0",children:"Ask me anything about your WordPress site. I can manage plugins, create content, and more."})]}),(0,I.jsxs)("div",{className:"flex flex-col gap-2.5 w-full",role:"group","aria-label":"Suggestion prompts",children:[(0,I.jsx)("div",{className:"flex gap-2.5 w-full",children:pt.slice(0,2).map(({icon:e,label:t,iconColor:n})=>(0,I.jsxs)("button",{className:"flex items-center gap-2.5 flex-1 py-3.5 px-4 bg-wpaia-bg border-0 rounded-2xl cursor-pointer text-[13px] font-medium text-[#18181B] text-left font-sans transition-colors hover:bg-wpaia-bg/80",onClick:()=>l?.(t),type:"button",children:[(0,I.jsx)("span",{className:"flex-shrink-0 flex items-center","aria-hidden":"true",children:(0,I.jsx)(e,{size:16,color:n})}),(0,I.jsx)("span",{children:t})]},t))}),(0,I.jsx)("div",{className:"flex gap-2.5 w-full",children:pt.slice(2,4).map(({icon:e,label:t,iconColor:n})=>(0,I.jsxs)("button",{className:"flex items-center gap-2.5 flex-1 py-3.5 px-4 bg-wpaia-bg border-0 rounded-2xl cursor-pointer text-[13px] font-medium text-[#18181B] text-left font-sans transition-colors hover:bg-wpaia-bg/80",onClick:()=>l?.(t),type:"button",children:[(0,I.jsx)("span",{className:"flex-shrink-0 flex items-center","aria-hidden":"true",children:(0,I.jsx)(e,{size:16,color:n})}),(0,I.jsx)("span",{children:t})]},t))})]})]}),e.map((e,t)=>(0,I.jsx)("div",{className:"flex mb-4 "+("user"===e.role?"flex-col items-end gap-1":"flex-row items-start gap-2.5"),children:"user"===e.role?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:"wpaia-user-bubble",children:e.isError?(0,I.jsx)("div",{className:"flex flex-col gap-3",children:(0,I.jsx)(gt,{errorTitle:e.errorTitle||"Connection Failed",errorDetail:e.errorDetail||null,errorMessage:e.errorMessage||e.content||"Something went wrong"})}):(0,I.jsx)("div",{className:"text-[15px] leading-normal",children:c(e)})}),e.createdAt&&!e.streaming&&(0,I.jsx)("span",{className:"text-[10px] text-wpaia-hint",children:ht(e.createdAt)})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(dt,{}),(0,I.jsxs)("div",{className:"flex-1 min-w-0",children:[void 0!==e.thinking&&(0,I.jsx)(ct,{content:e.thinking,isStreaming:!e.thinkingDone}),e.streaming&&!e.content&&!e.thinking&&!e.toolsRunning&&(0,I.jsxs)("div",{className:"pt-1.5",children:[(0,I.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,I.jsx)("span",{className:"text-sm font-medium text-wpaia-primary",children:"Thinking"}),(0,I.jsxs)("span",{className:"flex items-center gap-1 pt-0.5",children:[(0,I.jsx)("span",{className:"wpaia-dot"}),(0,I.jsx)("span",{className:"wpaia-dot"}),(0,I.jsx)("span",{className:"wpaia-dot"})]})]}),(0,I.jsxs)("div",{className:"flex flex-col gap-2.5","aria-hidden":"true",children:[(0,I.jsx)("div",{className:"h-3 rounded-md wpaia-shimmer",style:{width:"72%"}}),(0,I.jsx)("div",{className:"h-3 rounded-md wpaia-shimmer",style:{width:"55%"}}),(0,I.jsx)("div",{className:"h-3 rounded-md wpaia-shimmer",style:{width:"39%"}})]})]}),e.isError?(0,I.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,I.jsx)(gt,{errorTitle:e.errorTitle||"Connection Failed",errorDetail:e.errorDetail||null,errorMessage:e.errorMessage||e.content||"Something went wrong"}),e.errorExplanation&&(0,I.jsx)("p",{className:"text-[15px] leading-relaxed text-wpaia-text m-0",children:e.errorExplanation}),e.retryText&&a&&(0,I.jsxs)("div",{className:"flex gap-2.5",children:[(0,I.jsxs)("button",{className:"flex items-center gap-2 h-10 px-[18px] text-[13px] font-semibold text-white bg-wpaia-primary border-0 rounded-full cursor-pointer hover:bg-wpaia-primary-hover transition-colors",onClick:()=>a(e.retryText),children:[(0,I.jsx)(L,{size:14}),"Retry"]}),(0,I.jsx)("button",{className:"flex items-center gap-2 h-10 px-[18px] text-[13px] font-semibold text-[#52525B] bg-wpaia-bg border-0 rounded-full cursor-pointer hover:bg-wpaia-border transition-colors",onClick:()=>i?.(t),children:"Dismiss"})]})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:"text-[15px] leading-normal text-wpaia-text",children:c(e)}),e.streaming&&e.content&&(0,I.jsx)("span",{className:"wpaia-cursor"})]}),e.toolsRunning?.length>0&&(0,I.jsx)(ut,{toolsRunning:e.toolsRunning}),e.toolResults?.length>0&&e.toolResults.map((e,t)=>(0,I.jsx)(xt,{...e},t)),e.confirmation&&(0,I.jsx)(W,{confirmation:e.confirmation,onConfirm:r,onReject:s}),e.createdAt&&!e.streaming&&(0,I.jsx)("span",{className:"text-[10px] text-wpaia-hint mt-1 block",children:ht(e.createdAt)})]})]})},t)),n&&(0===e.length||!e[e.length-1]?.streaming)&&(0,I.jsxs)("div",{className:"flex items-start gap-2.5 mb-4","aria-label":"Thinking",children:[(0,I.jsx)(dt,{}),(0,I.jsxs)("div",{className:"pt-1.5",children:[(0,I.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,I.jsx)("span",{className:"text-sm font-medium text-wpaia-primary",children:"Thinking"}),(0,I.jsxs)("span",{className:"flex items-center gap-1 pt-0.5",children:[(0,I.jsx)("span",{className:"wpaia-dot"}),(0,I.jsx)("span",{className:"wpaia-dot"}),(0,I.jsx)("span",{className:"wpaia-dot"})]})]}),(0,I.jsxs)("div",{className:"flex flex-col gap-2.5","aria-hidden":"true",children:[(0,I.jsx)("div",{className:"h-3 rounded-md wpaia-shimmer",style:{width:260}}),(0,I.jsx)("div",{className:"h-3 rounded-md wpaia-shimmer",style:{width:200}}),(0,I.jsx)("div",{className:"h-3 rounded-md wpaia-shimmer",style:{width:140}})]})]})]}),(0,I.jsx)("div",{ref:o})]})},ft=({onSend:e,disabled:n,value:r,onChange:s,isStreaming:a,onStop:i,placeholder:l})=>{const[o,c]=(0,t.useState)(""),h=(0,t.useRef)(null),p=void 0!==r,d=p?r:o,u=p?s:c;(0,t.useEffect)(()=>{p&&r&&h.current&&h.current.focus()},[p,r]);const g=t=>{t.preventDefault(),d.trim()&&!n&&(e(d.trim()),u(""))},m=n&&!a;return(0,I.jsx)("div",{className:"flex-shrink-0 border-0 border-t border-solid border-wpaia-border bg-wpaia-panel px-5 pt-3 pb-5",children:(0,I.jsxs)("form",{className:"flex items-end gap-2.5",onSubmit:g,children:[(0,I.jsx)("div",{className:"flex-1 flex items-center rounded-full bg-wpaia-bg px-[18px]"+(m?" opacity-50":""),style:{minHeight:48},children:(0,I.jsx)("textarea",{ref:h,value:d,onChange:e=>u(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g(e))},placeholder:l||"Ask anything about your site...",disabled:n,rows:1,"aria-label":"Message input",className:"w-full resize-none border-0 bg-transparent py-3 text-[15px] text-wpaia-text font-sans placeholder:text-wpaia-hint focus:outline-none leading-normal focus:shadow-none"})}),a?(0,I.jsx)("button",{type:"button",className:"flex-shrink-0 flex items-center justify-center w-12 h-12 rounded-full border-0 cursor-pointer hover:opacity-90 transition-opacity",style:{background:"#18181B"},onClick:i,"aria-label":"Stop generating",children:(0,I.jsx)(P,{size:16,color:"#FFFFFF"})}):(0,I.jsx)("button",{type:"submit",className:"flex-shrink-0 flex items-center justify-center w-12 h-12 rounded-full border-0 cursor-pointer disabled:cursor-not-allowed transition-colors",style:{background:n||!d.trim()?"#D4D4D8":"#8B5CF6"},disabled:n||!d.trim(),"aria-label":"Send message",children:(0,I.jsx)(x,{size:20,color:"#FFFFFF"})})]})})},kt="flex items-center justify-center w-9 h-9 border-0 bg-wpaia-bg rounded-full text-wpaia-muted hover:bg-wpaia-border hover:text-wpaia-text cursor-pointer transition-colors",bt=({title:e,onBack:t,onDragStart:n,borderBottom:r=!1,children:s})=>(0,I.jsxs)("div",{className:"relative flex items-center justify-between px-5 py-4 flex-shrink-0 cursor-grab active:cursor-grabbing select-none"+(r?" border-0 border-b border-solid border-wpaia-border":""),onMouseDown:n,children:[(0,I.jsxs)("div",{className:"flex items-center gap-3",children:[t&&(0,I.jsx)("button",{className:kt,onClick:t,"aria-label":"Back",children:(0,I.jsx)(m,{size:18})}),(0,I.jsx)("h3",{className:"m-0 text-[17px] font-bold text-wpaia-text truncate max-w-[220px] font-heading",children:e})]}),(0,I.jsxs)("div",{className:"flex items-center gap-2",children:[(0,I.jsx)(v,{size:12,className:"text-wpaia-hint"}),s]})]});bt.circleBtn=kt;const wt=bt,yt=e=>{if(!e)return"";const t=new Date(e),n=new Date-t,r=Math.floor(n/6e4),s=Math.floor(n/36e5),a=Math.floor(n/864e5);return r<1?"just now":r<60?`${r}m`:s<24?`${s}h`:a<7?`${a}d`:t.toLocaleDateString([],{month:"short",day:"numeric"})},vt=({currentId:e,onSelect:n,onNew:s,onClose:a,onBack:i,onDragStart:l,fullView:o=!1})=>{const[c,h]=(0,t.useState)([]),[p,d]=(0,t.useState)(null),[u,x]=(0,t.useState)("");(0,t.useEffect)(()=>{r()({path:"wp-ai-assistant/v1/conversations"}).then(h).catch(()=>{})},[e]);const g=(0,t.useMemo)(()=>{const e=u.trim().toLowerCase(),t=e?c.filter(t=>(t.title||"Untitled conversation").toLowerCase().includes(e)):c,n={Recent:[],Yesterday:[],Older:[]};return t.forEach(e=>{n[(e=>{if(!e)return"Older";const t=new Date(e),n=new Date,r=new Date(n.getFullYear(),n.getMonth(),n.getDate()),s=new Date(r);return s.setDate(s.getDate()-1),t>=r?"Recent":t>=s?"Yesterday":"Older"})(e.updated_at)].push(e)}),n},[c,u]),m=Object.values(g).flat().length;return(0,I.jsxs)("div",{className:"flex flex-col"+(o?" flex-1 overflow-hidden":""),children:[(0,I.jsxs)(wt,{title:"History",onBack:i,onDragStart:l,children:[(0,I.jsx)("button",{className:wt.circleBtn,onClick:s,"aria-label":"New conversation",title:"New conversation",children:(0,I.jsx)(A,{size:18})}),a&&(0,I.jsx)("button",{className:wt.circleBtn,onClick:a,"aria-label":"Close",children:(0,I.jsx)(M,{size:16})})]}),(0,I.jsx)("div",{className:"px-6 pb-3",children:(0,I.jsxs)("div",{className:"relative",children:[(0,I.jsx)("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-wpaia-hint","aria-hidden":"true",children:(0,I.jsx)(T,{size:16})}),(0,I.jsx)("input",{type:"search",className:"w-full pl-11 pr-4 py-3 text-sm bg-wpaia-bg border-0 rounded-full font-sans text-wpaia-text placeholder:text-wpaia-hint focus:outline-none focus:ring-2 focus:ring-wpaia-primary/20",placeholder:"Search conversations...",value:u,onChange:e=>x(e.target.value),"aria-label":"Search conversations"})]})}),(0,I.jsx)("div",{className:"h-px bg-wpaia-border"}),(0,I.jsxs)("div",{className:"flex-1 overflow-y-auto px-3 pb-2 wpaia-scrollbar",role:"list","aria-label":"Conversation history",children:[0===m&&(0,I.jsx)("div",{className:"py-8 text-center text-xs text-wpaia-muted",children:u?"No results found.":"No conversations yet."}),["Recent","Yesterday","Older"].map(t=>{const a=g[t];return 0===a.length?null:(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{className:"px-3 pt-3 pb-2 text-[11px] font-semibold text-wpaia-hint uppercase tracking-wider",children:t}),(0,I.jsx)("div",{className:"flex flex-col gap-0.5",children:a.map(t=>{const{color:a,iconColor:i,Icon:l}=((e="")=>{const t=e.toLowerCase();return/plugin|update|install|activat/i.test(t)?{color:"#8B5CF6",iconColor:"#FFFFFF",Icon:$}:/post|page|content|creat|publish|draft/i.test(t)?{color:"#14B8A6",iconColor:"#FFFFFF",Icon:y}:/search|replac|find/i.test(t)?{color:"#F472B6",iconColor:"#FFFFFF",Icon:T}:/health|securit|error|warn|site|option/i.test(t)?{color:"#E4E4E7",iconColor:"#71717A",Icon:E}:{color:"#E4E4E7",iconColor:"#71717A",Icon:S}})(t.title),o=t.id===e;return(0,I.jsxs)("div",{className:"flex items-center gap-3.5 px-4 py-3.5 rounded-2xl cursor-pointer group transition-colors "+(o?"bg-wpaia-primary/[0.08]":"hover:bg-wpaia-bg"),onClick:()=>n(t.id),role:"listitem",tabIndex:0,onKeyDown:e=>"Enter"===e.key&&n(t.id),"aria-current":o?"true":void 0,children:[(0,I.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-full",style:{background:a},"aria-hidden":"true",children:(0,I.jsx)(l,{size:18,color:i})}),(0,I.jsx)("div",{className:"flex-1 min-w-0",children:(0,I.jsx)("div",{className:"text-[15px] text-wpaia-text truncate font-semibold leading-tight",children:t.title||"Untitled conversation"})}),(0,I.jsxs)("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[(0,I.jsx)("span",{className:"text-xs text-wpaia-hint font-medium",children:yt(t.updated_at)}),(0,I.jsx)("button",{className:"hidden group-hover:flex items-center justify-center w-7 h-7 border-0 bg-transparent rounded-lg text-wpaia-hint hover:text-wpaia-error-text cursor-pointer transition-colors",onClick:n=>(async(t,n)=>{t.stopPropagation(),d(n);try{await r()({path:`wp-ai-assistant/v1/conversations/${n}`,method:"DELETE"}),h(e=>e.filter(e=>e.id!==n)),e===n&&s()}catch{}finally{d(null)}})(n,t.id),disabled:p===t.id,"aria-label":"Delete conversation",title:"Delete",children:p===t.id?"…":(0,I.jsx)(D,{size:14})})]})]},t.id)})})]},t)})]})]})},jt=[{icon:function(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5"},child:[]},{tag:"path",attr:{d:"M14 2v4a2 2 0 0 0 2 2h4"},child:[]},{tag:"path",attr:{d:"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"},child:[]}]})(e)},label:"Content CRUD",actions:["read","create","update","delete"]},{icon:T,label:"Search & Replace",actions:["read","update"]},{icon:$,label:"Plugin Management",actions:["plugins"]},{icon:j,label:"Site Info & Options",actions:["site"]},{icon:function(e){return d({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"16 18 22 12 16 6"},child:[]},{tag:"polyline",attr:{points:"8 6 2 12 8 18"},child:[]}]})(e)},label:"Elementor Integration",actions:["read","update"]}],Nt=({label:e,description:t,checked:n,onChange:r,disabled:s})=>(0,I.jsxs)("div",{className:"flex items-center justify-between py-3 border-b border-wpaia-border last:border-b-0 "+(s?"opacity-50":""),children:[(0,I.jsxs)("div",{className:"flex-1 min-w-0 pr-3",children:[(0,I.jsx)("div",{className:"text-sm font-medium text-wpaia-text",children:e}),t&&(0,I.jsx)("div",{className:"text-xs text-wpaia-muted mt-0.5",children:t})]}),(0,I.jsxs)("label",{className:"relative inline-flex items-center flex-shrink-0 "+(s?"cursor-not-allowed":"cursor-pointer"),children:[(0,I.jsx)("input",{type:"checkbox",checked:n,onChange:s?void 0:e=>r(e.target.checked),disabled:s,className:"sr-only peer"}),(0,I.jsx)("div",{className:"w-9 h-5 bg-wpaia-border rounded-full peer-checked:bg-wpaia-primary transition-colors"}),(0,I.jsx)("div",{className:"absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform peer-checked:translate-x-4"})]})]}),St=()=>{const[e,n]=(0,t.useState)(!0),[s,a]=(0,t.useState)(!0),[i,l]=(0,t.useState)(!1),[o,c]=(0,t.useState)(!1);(0,t.useEffect)(()=>{r()({path:"wp-ai-assistant/v1/settings"}).then(e=>{void 0!==e.confirm_destructive&&n(e.confirm_destructive),void 0!==e.stream_responses&&a(e.stream_responses),void 0!==e.notification_sounds&&l(e.notification_sounds)}).catch(()=>{})},[]);const h="undefined"!=typeof wpaiaData&&wpaiaData.isAdmin,p=e=>{h&&(c(!0),r()({path:"wp-ai-assistant/v1/settings",method:"PATCH",data:e}).catch(()=>{}).finally(()=>c(!1)))},d="undefined"!=typeof wpaiaData&&wpaiaData.userRole?wpaiaData.userRole:"Subscriber",u="undefined"!=typeof wpaiaData&&Array.isArray(wpaiaData.userPermissions)?wpaiaData.userPermissions:[];return(0,I.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden",children:[(0,I.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-4 wpaia-scrollbar",children:[(0,I.jsxs)("div",{className:"mb-6",children:[(0,I.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,I.jsx)("div",{className:"text-xs font-semibold text-wpaia-muted uppercase tracking-wider",children:"Behavior"}),!h&&(0,I.jsx)("span",{className:"text-[10px] text-wpaia-muted italic",children:"View only"})]}),(0,I.jsx)(Nt,{label:"Confirm destructive actions",description:"Ask before deleting posts or modifying options.",checked:e,onChange:e=>{n(e),p({confirm_destructive:e})},disabled:!h}),(0,I.jsx)(Nt,{label:"Stream responses",description:"Show the assistant's reply as it's being generated.",checked:s,onChange:e=>{a(e),p({stream_responses:e})},disabled:!h}),(0,I.jsx)(Nt,{label:"Notification sounds",description:"Play a sound when a response is ready.",checked:i,onChange:e=>{l(e),p({notification_sounds:e})},disabled:!h})]}),(0,I.jsxs)("div",{className:"mb-6",children:[(0,I.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,I.jsx)("div",{className:"text-xs font-semibold text-wpaia-muted uppercase tracking-wider",children:"Your Permissions"}),(0,I.jsx)("span",{className:"text-[10px] font-semibold text-wpaia-primary bg-wpaia-primary-light px-2 py-0.5 rounded-full",children:d})]}),(0,I.jsx)("div",{className:"flex flex-col gap-1",children:jt.map(({icon:e,label:t,actions:n})=>{const r=(e=>e.some(e=>u.includes(e)))(n);return(0,I.jsxs)("div",{className:"flex items-center gap-3 py-2 "+(r?"":"opacity-50"),children:[(0,I.jsx)("span",{className:r?"text-wpaia-success-text":"text-wpaia-muted","aria-hidden":"true",children:(0,I.jsx)(e,{size:16})}),(0,I.jsx)("span",{className:"flex-1 text-sm text-wpaia-text",children:t}),r?(0,I.jsx)("span",{className:"text-wpaia-success-text text-sm font-bold","aria-label":"Allowed",children:"✓"}):(0,I.jsx)("span",{className:"text-wpaia-muted text-sm font-bold","aria-label":"Not allowed",children:"✗"})]},t)})})]})]}),(0,I.jsxs)("div",{className:"flex-shrink-0 px-4 py-3 border-t border-wpaia-border text-[11px] text-wpaia-hint text-center",children:["WP AI Assistant v1.0.0",o&&" · Saving…"]})]})},Ct=()=>{const[e,n]=(0,t.useState)(!1),[s,a]=(0,t.useState)(!1),[i,l]=(0,t.useState)("chat"),[o,c]=(0,t.useState)([]),[h,p]=(0,t.useState)(!1),[d,u]=(0,t.useState)(null),[x,g]=(0,t.useState)(!1),[m,f]=(0,t.useState)(""),y=(0,t.useRef)(null),v=(0,t.useRef)(!1),[j,S]=(0,t.useState)(null),R=(0,t.useRef)(!1),$=(0,t.useRef)({x:0,y:0,posX:0,posY:0}),L=s?600:420;(0,t.useEffect)(()=>{e&&!j&&S({x:window.innerWidth-L-16,y:window.innerHeight-620-16})},[e]),(0,t.useEffect)(()=>{if(!x)return;const e=e=>{"Escape"===e.key&&g(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[x]),(0,t.useEffect)(()=>{if(!e)return;const t=e=>{"Escape"!==e.key||x||n(!1)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[e,x]),(0,t.useEffect)(()=>{const e=()=>n(e=>!e);return document.addEventListener("wpaia-toggle",e),()=>document.removeEventListener("wpaia-toggle",e)},[]);const T=(0,t.useCallback)(e=>{if(0!==e.button)return;e.preventDefault(),R.current=!0,$.current={x:e.clientX,y:e.clientY,posX:j?.x??0,posY:j?.y??0};const t=e=>{if(!R.current)return;const t=e.clientX-$.current.x,n=e.clientY-$.current.y;S({x:Math.max(0,Math.min(window.innerWidth-100,$.current.posX+t)),y:Math.max(0,Math.min(window.innerHeight-50,$.current.posY+n))})},n=()=>{R.current=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n),document.body.style.cursor="",document.body.style.userSelect=""};document.body.style.cursor="grabbing",document.body.style.userSelect="none",document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)},[j]),E=(0,t.useCallback)(async e=>{p(!0);try{const t=await r()({path:`wp-ai-assistant/v1/conversations/${e}`});u(e),c((t.messages||[]).map(e=>({role:e.role,content:e.content,createdAt:e.created_at||null})))}catch{c([{role:"assistant",content:"Could not load conversation."}])}finally{p(!1)}},[]),B=(0,t.useCallback)(()=>{u(null),c([]),f("")},[]),P=(0,t.useCallback)(()=>{y.current&&(v.current=!0,y.current.abort())},[]),_=(0,t.useCallback)(()=>{a(e=>{const t=!e,n=t?600:420;return S(t=>{if(!t)return t;const r=n-(e?600:420);return{...t,x:Math.max(0,t.x-r)}}),t})},[]),F=(0,t.useCallback)(()=>{if(0===o.length)return;const e=o.map(e=>`[${e.role.toUpperCase()}]\n${e.content}`),t=new Blob([e.join("\n\n---\n\n")],{type:"text/plain"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="conversation.txt",r.click(),URL.revokeObjectURL(n)},[o]),O=(e,t)=>{let n="Request Failed",r=null,s=e,a=null;if(429===t)n="Rate Limit Reached",s="Too many requests sent in a short period.",a="You have reached your message limit. Please wait a moment before trying again.";else if(403===t)n="Permission Denied",s="Your account does not have access to this feature.",a="You do not have permission to use the AI assistant. Contact your administrator.";else if(t>=500)n="Server Error",r=`HTTP ${t}`,s=e,a="The server encountered an error. Please try again in a moment.";else if(e.includes("Failed to connect")||e.includes("connect to")){n="Connection Failed";const t=e.match(/(localhost[^\s:]*(?::\d+)?|[\d.]+:\d+)/);r=t?t[1]:null,s=e,a="Could not connect to the AI service. Make sure the backend server is running."}else e.includes("timed out")||e.includes("timeout")?(n="Request Timed Out",s="The request took too long to complete.",a="The AI service may be busy. Please try again."):(a=e,s="An unexpected error occurred.");return{errorTitle:n,errorDetail:r,errorMessage:s,errorExplanation:a}},q=async e=>{const t=null===d;let n=null;const s={role:"user",content:e,createdAt:(new Date).toISOString()};c(e=>[...e,s]),p(!0),f(""),c(e=>[...e,{role:"assistant",content:"",streaming:!0,createdAt:(new Date).toISOString()}]);const a=new AbortController;y.current=a;const i=setTimeout(()=>a.abort(),9e4);try{const s=await fetch(`${wpaiaData.restUrl}chat`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wpaiaData.nonce},body:JSON.stringify({message:e,...null!==d&&{conversation_id:d},stream:!0}),signal:a.signal});if(clearTimeout(i),!s.ok){const e=await(async e=>{try{const t=await e.json();return{message:t.message||t.data?.message||`Request failed (${e.status})`,status:e.status}}catch{return 429===e.status?{message:"Rate limit exceeded",status:429}:403===e.status?{message:"Permission denied",status:403}:e.status>=500?{message:"Internal server error",status:e.status}:{message:`Request failed (${e.status})`,status:e.status}}})(s),t=new Error(e.message);throw t.status=e.status,t}const l=s.body.getReader(),o=new TextDecoder;let h="";for(;;){const{done:s,value:a}=await l.read();if(s)break;h+=o.decode(a,{stream:!0});const i=h.split("\n");h=i.pop();for(const s of i){const a=s.trim();if(!a.startsWith("data: "))continue;let i;try{i=JSON.parse(a.slice(6))}catch{continue}switch(i.type){case"thinking_start":c(e=>{const t=[...e],n=t[t.length-1];return n?.streaming&&(t[t.length-1]={...n,thinking:"",thinkingDone:!1}),t});break;case"thinking":c(e=>{const t=[...e],n=t[t.length-1];return n?.streaming&&void 0!==n.thinking&&(t[t.length-1]={...n,thinking:n.thinking+(i.content||"")}),t});break;case"thinking_end":c(e=>{const t=[...e],n=t[t.length-1];return n?.streaming&&(t[t.length-1]={...n,thinkingDone:!0}),t});break;case"token":c(e=>{const t=[...e],n=t[t.length-1];return n?.streaming&&(t[t.length-1]={...n,content:n.content+(i.content||"")}),t});break;case"conversation_id":u(i.id),n=i.id;break;case"confirmation":c(e=>{const t=[...e],n=t[t.length-1];return n?.streaming&&(t[t.length-1]={...n,confirmation:{action_id:i.action_id,tool_name:i.tool_name,preview:i.preview,status:"pending"}}),t});break;case"tool_start":c(e=>{const t=[...e],n=t[t.length-1];return n?.streaming&&(t[t.length-1]={...n,toolsRunning:i.tools||[]}),t});break;case"error":{const t=O(i.message||"An error occurred",null);c(n=>{const r=[...n],s=r[r.length-1];return s?.streaming&&(r[r.length-1]={...s,content:i.message,streaming:!1,isError:!0,retryText:e,...t}),r});break}case"done":c(e=>{const t=[...e],n=t[t.length-1];return n?.streaming&&(t[t.length-1]={...n,streaming:!1,toolsRunning:null}),t}),t&&n&&r()({path:`wp-ai-assistant/v1/conversations/${n}/title`,method:"POST"}).catch(()=>{})}}}c(e=>{const t=[...e],n=t[t.length-1];return n?.streaming&&(t[t.length-1]={...n,streaming:!1,toolsRunning:null}),t})}catch(t){if(clearTimeout(i),"AbortError"===t.name){const t=v.current;if(v.current=!1,t)return void c(e=>{const t=[...e],n=t[t.length-1];return n?.streaming&&(t[t.length-1]={...n,streaming:!1}),t});const n=O("The request timed out",null);c(t=>{const r=[...t],s=r[r.length-1];return s?.streaming&&(r[r.length-1]={...s,content:"The request timed out.",streaming:!1,isError:!0,retryText:e,...n}),r})}else{const n=t.message||"Something went wrong. Please try again.",r=O(n,t.status||null);c(t=>{const s=[...t],a=s[s.length-1];return a?.streaming?s[s.length-1]={...a,content:n,streaming:!1,isError:!0,retryText:e,...r}:s.push({role:"assistant",content:n,isError:!0,retryText:e,...r}),s})}}finally{p(!1),y.current=null}},W=(0,t.useCallback)((e,t,n)=>{c(n=>n.map(n=>n.confirmation?.action_id===e?{...n,confirmation:{...n.confirmation,status:t}}:n)),n&&c(e=>[...e,{role:"assistant",content:n}])},[]),H=(0,t.useCallback)(async e=>{try{const t=await r()({path:`wp-ai-assistant/v1/confirm/${e}`,method:"POST",data:{approved:!0}});W(e,"confirmed",t.result?.message||t.result?.error||"Action completed.")}catch(t){W(e,"pending",`Error: ${t.message}`)}},[W]),Z=(0,t.useCallback)(async e=>{try{await r()({path:`wp-ai-assistant/v1/confirm/${e}`,method:"POST",data:{approved:!1}}),W(e,"rejected","Action cancelled.")}catch(t){W(e,"pending",`Error: ${t.message}`)}},[W]),V=(0,t.useCallback)(e=>{c(e=>{const t=[...e];return t.length&&t[t.length-1].isError&&t.pop(),t.length&&"user"===t[t.length-1].role&&t.pop(),t}),q(e)},[d]),Q=(0,t.useCallback)(e=>{c(t=>t.filter((t,n)=>n!==e))},[]);if(!e)return null;const U=d?o[0]?.content?.slice(0,40)||"Conversation":"New Conversation",Y="flex items-center gap-3 w-full px-4 py-2.5 border-0 bg-transparent text-sm text-wpaia-text hover:bg-wpaia-bg cursor-pointer text-left font-sans";return(0,I.jsxs)("div",{className:"fixed flex flex-col bg-wpaia-panel rounded-wpaia-panel font-sans overflow-hidden",role:"complementary","aria-label":"AI Assistant",style:{width:L,height:620,left:j?.x??0,top:j?.y??0,zIndex:99999,boxShadow:"0 25px 60px -12px rgba(0,0,0,0.25), 0 0 0 1px rgba(0,0,0,0.06)",transition:"width 0.2s ease"},children:["history"!==i&&(0,I.jsxs)(wt,{title:"settings"===i?"Settings":U,onBack:"settings"===i?()=>l("chat"):()=>l("history"),onDragStart:T,borderBottom:!0,children:["chat"===i&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("button",{className:wt.circleBtn,onClick:_,"aria-label":s?"Collapse panel":"Expand panel",children:s?(0,I.jsx)(C,{size:18}):(0,I.jsx)(N,{size:18})}),(0,I.jsx)("button",{className:wt.circleBtn,onClick:()=>g(e=>!e),"aria-label":"Open menu","aria-expanded":x,"aria-haspopup":"true",children:(0,I.jsx)(w,{size:18})})]}),"settings"===i&&(0,I.jsx)("button",{className:wt.circleBtn,onClick:()=>n(!1),"aria-label":"Close AI Assistant",children:(0,I.jsx)(M,{size:16})}),x&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:"fixed inset-0",style:{zIndex:1},onClick:()=>g(!1),"aria-hidden":"true"}),(0,I.jsxs)("div",{className:"absolute right-5 top-16 bg-wpaia-panel rounded-wpaia-card border border-solid border-wpaia-border py-1.5 min-w-[200px]",style:{zIndex:2,boxShadow:"0 10px 25px -5px rgba(0,0,0,0.1)"},role:"menu",children:[(0,I.jsxs)("button",{className:Y,role:"menuitem",onClick:()=>{B(),g(!1)},children:[(0,I.jsx)("span",{className:"text-wpaia-muted",children:(0,I.jsx)(A,{size:15})}),"New conversation"]}),(0,I.jsxs)("button",{className:Y,role:"menuitem",onClick:()=>{c([]),g(!1)},children:[(0,I.jsx)("span",{className:"text-wpaia-muted",children:(0,I.jsx)(D,{size:15})}),"Clear conversation"]}),(0,I.jsxs)("button",{className:Y,role:"menuitem",onClick:()=>{F(),g(!1)},children:[(0,I.jsx)("span",{className:"text-wpaia-muted",children:(0,I.jsx)(b,{size:15})}),"Export chat"]}),(0,I.jsx)("div",{className:"my-1.5 border-0 border-t border-solid border-wpaia-border"}),(0,I.jsxs)("button",{className:Y,role:"menuitem",onClick:()=>{l("settings"),g(!1)},children:[(0,I.jsx)("span",{className:"text-wpaia-muted",children:(0,I.jsx)(z,{size:15})}),"Settings"]}),(0,I.jsxs)("button",{className:Y,role:"menuitem",onClick:()=>g(!1),children:[(0,I.jsx)("span",{className:"text-wpaia-muted",children:(0,I.jsx)(k,{size:15})}),"Help & shortcuts"]}),(0,I.jsxs)("button",{className:Y,role:"menuitem",onClick:()=>{n(!1),g(!1)},children:[(0,I.jsx)("span",{className:"text-wpaia-muted",children:(0,I.jsx)(M,{size:15})}),"Close"]})]})]})]}),"history"===i&&(0,I.jsx)(vt,{currentId:d,onSelect:e=>{E(e),l("chat")},onNew:()=>{B(),l("chat")},onClose:()=>n(!1),onDragStart:T,fullView:!0}),"settings"===i&&(0,I.jsx)(St,{onBack:()=>l("chat")}),"chat"===i&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(mt,{messages:o,loading:h,onConfirm:H,onReject:Z,onRetry:V,onDismissError:Q,onChipSelect:e=>f(e)}),(0,I.jsx)(ft,{onSend:q,disabled:h||o.some(e=>"pending"===e.confirmation?.status),value:m,onChange:f,isStreaming:h,onStop:P,placeholder:o.some(e=>"pending"===e.confirmation?.status)?"Waiting for confirmation…":void 0})]})]})};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("wpaia-chat-root");e&&(0,t.createRoot)(e).render((0,I.jsx)(Ct,{}))})})();